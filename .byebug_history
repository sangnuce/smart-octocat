continue
delete_message room.id, need_delete_notis.map{|noti| noti.chatwork_message_id}
need_delete_notis = PullNotification.where(pull_request: pull_request).need_delete
real_action
continue
delete_message room.id, need_delete_notis.map{|noti| noti.chatwork_message_id}
need_delete_notis.map{|noti| noti.chatwork_message_id}
need_delete_notis.count
need_delete_notis = PullNotification.where(pull_request: pull_request).need_delete
continue
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept_encoding"],"Accept-Language" => ENV["accept_language"],"User-Agent" => ENV["user_agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"}).to_s
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept_encoding"],"Accept-Language" => ENV["accept_language"],"User-Agent" => ENV["user_agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"})
a.to_s
continue
a.to_s
 ENV["connection"]
 ENV["requested_with"]
ENV["referer"]
ENV["accept"]
ENV["user_agent"]
ENV["accept_language"]
ENV["accept_encoding"]
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept_encoding"],"Accept-Language" => ENV["accept_language"],"User-Agent" => ENV["user_agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"}).to_s
accept_encoding
continue
ENV["user_agent"]
ENV["accept_language"]
ENV["accept_encoding"]
ENV["new_relic_id"]
X-NewRelic-ID
ENV["cookie"]
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept_encoding"],"Accept-Language" => ENV["accept_language"],"User-Agent" => ENV["user_agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"}).to_s
continue
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept-encoding"],"Accept-Language" => ENV["accept-language"],"User-Agent" => ENV["user-agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"}).to_s
ENV
 ENV["accept_encoding"]
 ENV["accept-encoding"]
ENV["dnt"]
ENV["cookie"]
ENV["new_relic_id"]
HTTP.headers("Cookie" => ENV["cookie"],"X-NewRelic-ID" => ENV["new_relic_id"],"DNT" => ENV["dnt"],"Accept-Encoding" => ENV["accept-encoding"],"Accept-Language" => ENV["accept-language"],"User-Agent" => ENV["user-agent"],"Accept" => ENV["accept"],"Referer" => ENV["referer"],"X-Requested-With" => ENV["requested_with"],"Connection" => ENV["connection"]).post("https://www.chatwork.com/gateway.php", params: {cmd: "delete_chat",myid: "1565457", _v: "1.80a", _av: "5", _t: "bbbd5cb7d139981be18d05827189ab2cb41cf5a15838523caabd8",ln: "en", chat_id: message_id, room_id: room_id, _: "1480086077746"}).to_s
a.to_s
continue
a.to_s
continue
a.to_s
a
continue
delete_message "39952639", ["1605984003"]
continue
delete_message "39952639", ["1605984003"]
continue
delete_message "39952639", ["1605984003"]
delete_message "39952639", "1605984003"
continue
real_action
continue
real_action
continue
message_id
continue
JSON.parse(a)
a.to_sym
a = http_request.body.to_s
continue
a.to_s
a.to_sym
a = http_request.body
a.to_s
a.to_a
a
a = http_request.body
http_request.body
http_request
h = http_request.body
continue
a
a[0].to_sym
a[0].to_a
a[0][0]
a[0]
a[0]["\"message_id\""]
a[0]["message_id"]
a[0]
a = http_request.body.to_a
continue
http_request.body.to_a
continue
http_request.body.to_a
http_request.body.to_s
continue
http_request.body.to_a
http_request.to_a
http_request.to_s
continue
http_request.body.to_a
http_request.body
http_request.body.to_a
http_request.to_a
http_request
continue
http_request.body
http_request.body.to_a
http_request.to_a
http_request
http_request\
http_request.to_a
http_request.body.to_a
http_request.body.methods
http_request.body
http_request.methods
http_request.method
http_request.content
http_request
continue
not_deployed_pulls
continue
PullRequest.first
not_deployed_pulls
continue
to_part
continue
message
continue
pull.title
pull = not_deployed_pulls.first
not_deployed_pulls
message.present?
message
continue
pull.title
pull
not_deployed_pulls
continue
PullRequest.last.update merged: true
PullRequest.not_deployed
PullRequest.last
PullRequest.not_deployed
to_part
message
continue
@pull_request
continue
to_part.select{|f| f != ""}.size
to_part.select{|f| f != ""}
to_part
[nil,nil].size
to_part.size
to_part
continue
@pull_request
continue
@pull_request.update happy_reviewer_num: 0
@pull_request
continue
@pull_request
continue
@pull_request
continue
@pull_request
continue
@pull_request.state
@params["pull_request"]["state"]
@params["pull_request"]
@pull_request.state
@pull_request
continue
@pull_request
continue
room
continue
@room
continue
@action
Room.all
@params["repository"]["html_url"]
@params["repository"]
@params
@room
continue
@params["repository"]["html_url"]
@params["repository"]
@params["sender"]
@params["pusher"]
@params["action"]
@params.keys
@params
@action
continue
@pull_request["html_url"]
continue
@pull_request["html_url"]
to_part
n
to_part
n
reviewers = User.joins(:user_rooms).where("room_id = ? AND (user_rooms.role = ? OR user_rooms.role = ?)", room.id, 0, 1)
reviewers = User.joins(:user_rooms).where("room_id = ? AND (user_rooms.role = ? OR user_rooms.role = ?)", room.id, 0, 1).count
User.joins(:user_rooms).where("room_id = ? AND (user_rooms.role = ? OR user_rooms.role = ?)", room.id, 0, 1).count
User.joins(:user_rooms).where("room_id = ? AND (user_rooms.role = ?OR user_rooms.role = ?)", room.id, 0, 1).count
User.joins(:user_rooms).where "room_id = ? AND (user_rooms.role = ?OR user_rooms.role = ?)", room.id, 0, 1
reviewers.count
reviewers
n
Room.find_by project_github_link: @params["repository"]["html_url"]
@params["repository"]["html_url"]
pull_owner
n
User.count
continue
User.count
@pull_request["user"]["login"]
pull_owner
n
continue
HTTP.headers("X-ChatWorkToken" => "256a72efa51cd416b879d729eb794ee2").post("https://api.chatwork.com/v1/rooms/60833608/messages", body: body)
HTTP.headers("X-ChatWorkToken" => "256a72efa51cd416b879d729eb794ee2")
pull_owner
continue
params["review"]["html_url"]
params["review"]["pull_request_url"]
params["review"].keys
params["review"]
continue
request.headers["X-GitHub-Event"]
continue
request.headers["X-GitHub-Event"]
continue
request.headers["X-GitHub-Event"]
continue
request.headers["X-GitHub-Event"]
request.header["X-GitHub-Event"]
continue
action
n
continue
params["pull_request"]["user"]
params["pull_request"].keys
params["comment"]["user"]
params["comment"].keys
params["comment"]
params
request.headers["X-GitHub-Event"]
request.headers
request.header 
continue
params
